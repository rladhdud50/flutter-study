import 'package:flutter_test/flutter_test.dart';
import 'package:image_search/data/data_source/PixabayApi.dart';
import 'package:image_search/data/data_source/result.dart';
import 'package:image_search/data/repository/pixabay_api.dart';
import 'package:image_search/domain/model/photo.dart';
import 'package:mockito/annotations.dart';
import 'package:http/http.dart' as http;
import 'package:mockito/mockito.dart';

import 'pixabay_api_test.mocks.dart';


@GenerateMocks([http.Client])
void main() {
  test('Pixabay Api Test', () async {
    final client = MockClient();
    final api = PhotoApiRepositoryImpl(PixabayApi(client));

    when(client.get(Uri.parse(
            '${PixabayApi.baseUrl}/api/?key=${PixabayApi.key}&q=doge&image_type=photo')))
        .thenAnswer((_) async => http.Response(fakeJsonBody, 200));

    final Result<List<Photo>> result = await api.fetch('doge');

    expect((result as Success<List<Photo>>).data.first.id, 3118803);

    verify(client.get(Uri.parse(
        '${PixabayApi.baseUrl}/api/?key=${PixabayApi.key}&q=doge&image_type=photo')));
  });
}

String fakeJsonBody = """
{"total":40,"totalHits":40,"hits":[{"id":3118803,"pageURL":"https://pixabay.com/photos/venice-doges-palace-square-3118803/","type":"photo","tags":"venice, doge's palace, square","previewURL":"https://cdn.pixabay.com/photo/2018/01/30/13/42/venice-3118803_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/gb4085e465adae61990e1f405f95b44fe906d4f56a6e7eadf69ebbd95b608f1f6d95535ff6191559ec02e73b077ebd436f27b61b6ac4bf7a9ac37be9a1e749f4c_640.jpg","webformatWidth":640,"webformatHeight":426,"largeImageURL":"https://pixabay.com/get/gd7c16ced51a5ca8fbd9806c0fd9a45467381ac82a52699bd506732b98c040a7cba8224b8a4525f2ccbff87d478ccb7f33a644a3625b462e85e2101e2c2427c4f_1280.jpg","imageWidth":4830,"imageHeight":3220,"imageSize":2940626,"views":58005,"downloads":44702,"collections":193,"likes":176,"comments":24,"user_id":3628174,"user":"wiggijo","userImageURL":"https://cdn.pixabay.com/user/2016/10/28/09-04-12-659_250x250.jpeg"},{"id":4421987,"pageURL":"https://pixabay.com/photos/english-bull-doge-dog-4421987/","type":"photo","tags":"english bull doge, dog, domestic animal","previewURL":"https://cdn.pixabay.com/photo/2019/08/21/20/34/english-bull-doge-4421987_150.jpg","previewWidth":114,"previewHeight":150,"webformatURL":"https://pixabay.com/get/g5daaf5cacf2e52231e8ac9779352f78f209040386dcbb795e672a16ca67116d73ca78c9a691723e69d57c3fb947d453fbd081c4f93e6eb8cb3eb3717b5a8aeb9_640.jpg","webformatWidth":487,"webformatHeight":640,"largeImageURL":"https://pixabay.com/get/ga30886fa41f0133c9e2248ba337f41c875057cbfdd5cf1346d0a3b343d264d98fb7418e1b9df8927df2a2898e425712789d92806f09b80877c5128ef71610ec1_1280.jpg","imageWidth":5000,"imageHeight":6571,"imageSize":7870159,"views":4622,"downloads":3648,"collections":30,"likes":37,"comments":8,"user_id":1627417,"user":"Myriams-Fotos","userImageURL":"https://cdn.pixabay.com/user/2022/03/01/09-22-13-51_250x250.jpg"},{"id":470561,"pageURL":"https://pixabay.com/photos/st-marks-square-piazzetta-san-marco-470561/","type":"photo","tags":"st mark's square, piazzetta san marco, italy","previewURL":"https://cdn.pixabay.com/photo/2014/10/02/19/51/st-marks-square-470561_150.jpg","previewWidth":150,"previewHeight":98,"webformatURL":"https://pixabay.com/get/g8354526b75d273f490a4d7cc08a7a6579ee58b74a8a52fb956434a8ca0bd97e8a02137a486488ef5b841922f23e8cd1b_640.jpg","webformatWidth":640,"webformatHeight":421,"largeImageURL":"https://pixabay.com/get/g6f68661d65d84b96de73919830924284adb7b6272bcb20712e1413a46edde1df021efe19dd02294efb0c57ce33a90066767cda01e34b44ee6644568078ca0123_1280.jpg","imageWidth":4325,"imageHeight":2848,"imageSize":3134082,"views":6926,"downloads":3905,"collections":52,"likes":16,"comments":0,"user_id":179405,"user":"EdiHoch","userImageURL":""},{"id":4815677,"pageURL":"https://pixabay.com/photos/st-marks-square-doges-palace-4815677/","type":"photo","tags":"st mark's square, doge's palace, markus tower","previewURL":"https://cdn.pixabay.com/photo/2020/02/03/13/38/st-marks-square-4815677_150.jpg","previewWidth":150,"previewHeight":107,"webformatURL":"https://pixabay.com/get/g0484184150f62a0c1bff8cfc58cd15ff0463bb2f1fe9340535c3c195955bff04145ce764ccb8b8fd4da64dfb08a203e49d7d05df98d056b5c8c6522156d80cbc_640.jpg","webformatWidth":640,"webformatHeight":459,"largeImageURL":"https://pixabay.com/get/g3b99c42407d2911ef68658d9d412b414569044a5005228541c5dc79833c30852192e16fad85718fddb9fcb9637a084969e210d71f5e07ae64fd813789a5b8077_1280.jpg","imageWidth":5601,"imageHeight":4022,"imageSize":4541051,"views":3597,"downloads":2475,"collections":10,"likes":44,"comments":35,"user_id":1130890,"user":"Peggychoucair","userImageURL":"https://cdn.pixabay.com/user/2022/02/25/20-32-40-46_250x250.jpg"},{"id":4421768,"pageURL":"https://pixabay.com/photos/english-bull-doge-dog-4421768/","type":"photo","tags":"english bull doge, pet, dog","previewURL":"https://cdn.pixabay.com/photo/2019/08/21/18/40/english-bull-doge-4421768_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/g4ec6f5cf1689c20590cf50e31ca80a9060cc6a06475ac36467ff44b6af0579e1b4886e37f37af5a05524550f7139a1d7163967dd334a3d9ab4d431ad66c1b4ed_640.jpg","webformatWidth":640,"webformatHeight":426,"largeImageURL":"https://pixabay.com/get/gc60c033f7de559493dae5c555cec89859f541eff2863bc35d3f5d89b9ffc1f8a6f94be80704e287584ac3dd9e783f9ef6c133a2d7d92c7ce0359adf374fe9959_1280.jpg","imageWidth":6000,"imageHeight":4000,"imageSize":6510903,"views":3642,"downloads":2762,"collections":18,"likes":26,"comments":6,"user_id":1627417,"user":"Myriams-Fotos","userImageURL":"https://cdn.pixabay.com/user/2022/03/01/09-22-13-51_250x250.jpg"},{"id":554807,"pageURL":"https://pixabay.com/photos/doges-palace-venice-church-554807/","type":"photo","tags":"doge's palace, venice, church","previewURL":"https://cdn.pixabay.com/photo/2014/12/03/00/07/doges-palace-554807_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/ga6d586fc2f294a00f09c6f3d5a37ce90d0636bf6d5ead987d0ad34713ea2a4400e8d17db95e345181690a1f94cd8e912_640.jpg","webformatWidth":640,"webformatHeight":426,"largeImageURL":"https://pixabay.com/get/g6423e9b477f4f9f4c6b5015545ba9e56492d9d200a5432603f52a2d74d3bf0fc8f0836c7e8703c17ded7c50179eac413deb6056c6a2947e389369c43037de1ab_1280.jpg","imageWidth":6000,"imageHeight":4000,"imageSize":7777682,"views":5461,"downloads":2492,"collections":35,"likes":16,"comments":3,"user_id":495756,"user":"495756","userImageURL":""},{"id":821279,"pageURL":"https://pixabay.com/photos/piazza-san-marco-venice-821279/","type":"photo","tags":"piazza san marco, venice, doge's palace","previewURL":"https://cdn.pixabay.com/photo/2015/06/25/13/57/piazza-san-marco-821279_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/g582b898974c2ffd7a6c844a4d21eafa71e08f2cab2628d17a53b21d8ed43b2e2a9701dd5af28e94b113b425fa6b3f865_640.jpg","webformatWidth":640,"webformatHeight":426,"largeImageURL":"https://pixabay.com/get/g092d95afe5c0e5ffddab2471d47a0477ce3792dbe9a4bd61393df04a85f58ae608a8c62d0e7dc9ce6f3ee15e86d30f7e0adfbf4091e8943f132851799a1db572_1280.jpg","imageWidth":3456,"imageHeight":2304,"imageSize":2230804,"views":5319,"downloads":3121,"collections":34,"likes":13,"comments":2,"user_id":1114433,"user":"Artheos","userImageURL":"https://cdn.pixabay.com/user/2015/06/20/10-26-40-145_250x250.jpg"},{"id":3605819,"pageURL":"https://pixabay.com/photos/venice-palace-doge-architecture-3605819/","type":"photo","tags":"venice, palace, doge","previewURL":"https://cdn.pixabay.com/photo/2018/08/14/15/15/venice-3605819_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/ga67c29992cd386013c86434fc0a0e1700d9257c28be8506985967c557a8a6feca5ccb4ea193fc85a1d34b773afd08741835ffb7bb8788689f5d96a56977fc322_640.jpg","webformatWidth":640,"webformatHeight":426,"largeImageURL":"https://pixabay.com/get/g3f2cdc012622285101e833199e2465b2c7514081b528fe259f3e70965cca80c6d5e37f22604baebd2d242a02716e5f1b1caaa920691b1f8c97dd188e8e4b11ff_1280.jpg","imageWidth":6000,"imageHeight":4000,"imageSize":8202561,"views":3262,"downloads":1982,"collections":11,"likes":22,"comments":0,"user_id":6483933,"user":"cedlambert","userImageURL":"https://cdn.pixabay.com/user/2020/09/09/10-59-22-709_250x250.jpg"},{"id":470582,"pageURL":"https://pixabay.com/photos/st-marks-square-piazzetta-san-marco-470582/","type":"photo","tags":"st mark's square, piazzetta san marco, italy","previewURL":"https://cdn.pixabay.com/photo/2014/10/02/20/01/st-marks-square-470582_150.jpg","previewWidth":150,"previewHeight":97,"webformatURL":"https://pixabay.com/get/g7f517f36389508e58c25f5d05909cf5fa7d3b23d655d1f07aa21ce67a7db34f3a82de35e59f5b408bdba7829d9a7d2b4_640.jpg","webformatWidth":640,"webformatHeight":415,"largeImageURL":"https://pixabay.com/get/g710b997c8a34e38a2a1a3e265e3e71c459f71d494bac22e0454903ccad7a96eebdb0b98e93c17953a56ce9e07cf1ffe7b249a5a2daa7e4575e15a358ec73d9e7_1280.jpg","imageWidth":4319,"imageHeight":2807,"imageSize":3176646,"views":5707,"downloads":2592,"collections":28,"likes":8,"comments":0,"user_id":179405,"user":"EdiHoch","userImageURL":""},{"id":470579,"pageURL":"https://pixabay.com/photos/st-marks-square-piazzetta-san-marco-470579/","type":"photo","tags":"st mark's square, piazzetta san marco, italy","previewURL":"https://cdn.pixabay.com/photo/2014/10/02/19/58/st-marks-square-470579_150.jpg","previewWidth":98,"previewHeight":150,"webformatURL":"https://pixabay.com/get/g35c772925616d141b2b2ca509b9878ebe86e70df33a325c9e1a5381a94a3c051cdbaa9cf0a65c7a5ace38bb673220b4e_640.jpg","webformatWidth":419,"webformatHeight":640,"largeImageURL":"https://pixabay.com/get/gf647bfc982b01ac8eb59f288dac26c0ae2a12dde805a459784d8d23c3252c6d8f57715b478ca468bb6b380c812b66d56a048c3306a5d3875ad269db339def733_1280.jpg","imageWidth":2803,"imageHeight":4280,"imageSize":2633730,"views":2624,"downloads":1412,"collections":25,"likes":10,"comments":1,"user_id":179405,"user":"EdiHoch","userImageURL":""},{"id":2516064,"pageURL":"https://pixabay.com/photos/doges-palace-doge-venice-italy-2516064/","type":"photo","tags":"doge's palace, doge, nature","previewURL":"https://cdn.pixabay.com/photo/2017/07/18/15/16/doges-palace-2516064_150.jpg","previewWidth":150,"previewHeight":97,"webformatURL":"https://pixabay.com/get/gd29b4e5c87759b9742f812fab628d4c669a308b8c48fad4f550c83263316150812322d92e34045315d31386cfad8ac70f3a58a2fc1ff6a999d0055d0e05da682_640.jpg","webformatWidth":640,"webformatHeight":417,"largeImageURL":"https://pixabay.com/get/gacca0fb39f5eee3bf4ba7a4d83f5663653a291a1137fe3252eb3d79fc664bbba9a58410c4627b0d09b2bb629fcf58cf5d62528ad2d52913e4813fb4d0d119679_1280.jpg","imageWidth":4808,"imageHeight":3136,"imageSize":2487042,"views":1923,"downloads":1189,"collections":21,"likes":8,"comments":0,"user_id":4248505,"user":"Sarah_Loetscher","userImageURL":"https://cdn.pixabay.com/user/2021/02/02/15-53-31-142_250x250.jpeg"},{"id":4575648,"pageURL":"https://pixabay.com/photos/puppy-dog-expression-4575648/","type":"photo","tags":"puppy, dog, expression","previewURL":"https://cdn.pixabay.com/photo/2019/10/25/00/09/puppy-4575648_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/g4864cfddc6c0167af158f742d8da64f5059ce69849a271fa3d467412015514107d38bd67877d58092ddc5c67351bbd1377a54f8e29bab6fc857afe6b250c213a_640.jpg","webformatWidth":640,"webformatHeight":426,"largeImageURL":"https://pixabay.com/get/g6df089bb650af8b264e64252651474ec70d21a22090859376827ecf8b2673b40ffff86ba1fa33a4fd57b2a3232eb6b1901e0947d0ae8f19b5d4f47d056c9760d_1280.jpg","imageWidth":6000,"imageHeight":4000,"imageSize":5583260,"views":2813,"downloads":2269,"collections":16,"likes":6,"comments":2,"user_id":11004713,"user":"DaModernDaVinci","userImageURL":"https://cdn.pixabay.com/user/2021/06/15/01-28-17-70_250x250.jpeg"},{"id":1972697,"pageURL":"https://pixabay.com/photos/italy-venice-palace-doges-marquee-1972697/","type":"photo","tags":"italy, venice, palace","previewURL":"https://cdn.pixabay.com/photo/2017/01/11/19/27/italy-1972697_150.jpg","previewWidth":150,"previewHeight":112,"webformatURL":"https://pixabay.com/get/gdb5c32bb059f0e6c0907ab520225646617242c7775eed80656aa9c013bc22fb827bc7ed27e0b9adc79a1c9cc32a392a0ad55d6f27cf8d8dc3ea0fde3bd2f2449_640.jpg","webformatWidth":640,"webformatHeight":480,"largeImageURL":"https://pixabay.com/get/g19fa445b5fb9b58af9a206916adcd267e2857b695591927af1be22e33cd3625b8cecd2d2628c412e0c84ff5bec027971c66cfb1c93291063c0dc11ffb4091202_1280.jpg","imageWidth":4000,"imageHeight":3000,"imageSize":3648253,"views":1876,"downloads":1084,"collections":18,"likes":6,"comments":0,"user_id":1045091,"user":"DEZALB","userImageURL":"https://cdn.pixabay.com/user/2020/08/12/07-30-14-984_250x250.jpg"},{"id":5112985,"pageURL":"https://pixabay.com/photos/doges-palace-italy-5112985/","type":"photo","tags":"doges palace, italy, nature","previewURL":"https://cdn.pixabay.com/photo/2020/04/30/14/13/doges-palace-5112985_150.jpg","previewWidth":150,"previewHeight":100,"webformatURL":"https://pixabay.com/get/ga940ae84795a352173f4d404d5097f8ac85a748270b5019d5ea039f486a67286c9709a764d2f46312d806859ad9b96d25083431d532ace86e286a8e97b202adc_640.jpg","webformatWidth":640,"webformatHeight":427,"largeImageURL":"https://pixabay.com/get/g0a4260500b7ccd67a11996a054576ce3fcf3b152f8a1c69a03dfec5ba7b6ca43a00c6248593b07c14edfdd5d382d893af794cdef9525515917c822bd814c555a_1280.jpg","imageWidth":5380,"imageHeight":3587,"imageSize":6411351,"views":2402,"downloads":1939,"collections":4,"likes":12,"comments":2,"user_id":16040009,"user":"NeilMorrell","userImageURL":"https://cdn.pixabay.com/user/2020/05/05/16-20-31-303_250x250.jpeg"},{"id":316734,"pageURL":"https://pixabay.com/photos/dog-doges-ceramic-grave-headstone-316734/","type":"photo","tags":"dog, doges, ceramic","previewURL":"https://cdn.pixabay.com/photo/2014/04/05/11/41/dog-316734_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/g9b1256c60706d27f18ad884ae6631595acc1d2baf887438d5787dd4072a990aaf6506cd2fc27d6bbb27d67912acb85d0_640.jpg","webformatWidth":640,"webformatHeight":426,"largeImageURL":"https://pixabay.com/get/g5d87142eed695cc018d1b4dd80d20fdf573a06691a923141009685914a1d3253243fb9bac1d77b3cb22bec6dc1813b83fccc15a46712f21b3d31ad143b6c48a7_1280.jpg","imageWidth":1920,"imageHeight":1280,"imageSize":435298,"views":3168,"downloads":999,"collections":6,"likes":12,"comments":6,"user_id":14,"user":"PublicDomainPictures","userImageURL":"https://cdn.pixabay.com/user/2012/03/08/00-13-48-597_250x250.jpg"},{"id":744331,"pageURL":"https://pixabay.com/photos/venice-palace-italy-doges-palace-744331/","type":"photo","tags":"venice, palace, italy","previewURL":"https://cdn.pixabay.com/photo/2015/04/28/20/35/venice-744331_150.jpg","previewWidth":99,"previewHeight":150,"webformatURL":"https://pixabay.com/get/g9bf23b0092752dd05fa296cfa4e52025774cf839dbb7cb1025bd5778c75dbfdf56da55fa0fb476818f34700220981ce9_640.jpg","webformatWidth":424,"webformatHeight":640,"largeImageURL":"https://pixabay.com/get/gf8f82f69a5a32ede17eb37766df10a98165376febe51272e6a1bca8c33d0b93da15537886c4232d4d4e0a142e230f457d54a95b412f12d7e7e5395e57bcb0ac3_1280.jpg","imageWidth":3264,"imageHeight":4928,"imageSize":4439100,"views":2726,"downloads":1913,"collections":15,"likes":4,"comments":0,"user_id":978983,"user":"micakonrad","userImageURL":""},{"id":2384463,"pageURL":"https://pixabay.com/photos/venice-san-marco-statue-italy-2384463/","type":"photo","tags":"venice, san marco, statue","previewURL":"https://cdn.pixabay.com/photo/2017/06/08/18/27/venice-2384463_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/gcb1f2d5414fdfb71b362dce6784fd42d3bb2b51ecb1cb00fcedfa51eb9f224d1291d3a62786aefab264c812704800c3c39c89cee36a475e07a874e92a99c0917_640.jpg","webformatWidth":640,"webformatHeight":426,"largeImageURL":"https://pixabay.com/get/g429f7a692cda80d2ae3ae76fe407908949101cd37e2212fdcd297c6236e9f33b21798308cb6ddb55593ce24429a374805281788a0f585bd1c71f6848724a02ef_1280.jpg","imageWidth":5184,"imageHeight":3456,"imageSize":4037483,"views":1346,"downloads":878,"collections":17,"likes":2,"comments":0,"user_id":5581143,"user":"jlfajardo","userImageURL":"https://cdn.pixabay.com/user/2017/06/08/15-44-07-111_250x250.jpg"},{"id":6399898,"pageURL":"https://pixabay.com/photos/st-marks-square-tower-gull-bird-6399898/","type":"photo","tags":"st mark's square, tower, android wallpaper","previewURL":"https://cdn.pixabay.com/photo/2021/07/09/19/39/st-marks-square-6399898_150.jpg","previewWidth":100,"previewHeight":150,"webformatURL":"https://pixabay.com/get/gacff54fad8a4f877501d060698eeffb34a69fb45e343619c66cd95b38b376ff60ae54d10f3892fcd5d656ebd74dbf5e8231cbdde3648c9a52c02a42aee06d29e_640.jpg","webformatWidth":427,"webformatHeight":640,"largeImageURL":"https://pixabay.com/get/g9e532f5afd8ac13aa49f93ea01ad899ca6e391447123dc1dddc9a51a0392b7c7936da2d16d4791fb74ea30e2b5be151880b4244382e6d7f8794ccdffc4b0e7ba_1280.jpg","imageWidth":3712,"imageHeight":5568,"imageSize":9412575,"views":3174,"downloads":2892,"collections":3,"likes":8,"comments":4,"user_id":13177285,"user":"Gruendercoach","userImageURL":"https://cdn.pixabay.com/user/2021/07/11/18-47-15-179_250x250.jpg"},{"id":3844096,"pageURL":"https://pixabay.com/photos/venice-woman-beauty-romantic-italy-3844096/","type":"photo","tags":"venice, woman, beauty","previewURL":"https://cdn.pixabay.com/photo/2018/11/28/16/59/venice-3844096_150.jpg","previewWidth":103,"previewHeight":150,"webformatURL":"https://pixabay.com/get/g27391c237a3397a989aef907d32cd27853db1c64ce95d2f5f8ce7247b589f561a512dbae18eadb316cf314dc06e0c5ad8cd6dc018be2f76ab8781d10aebaa363_640.jpg","webformatWidth":442,"webformatHeight":640,"largeImageURL":"https://pixabay.com/get/g84e7fb09ada6adae5cf955a45c707f6fae10bdac3602bcd0f27f8ad576cc2193e9f8c82282337cd5d233cc6d053206aac641383bdd87af7b44c8df3adf5adab0_1280.jpg","imageWidth":2835,"imageHeight":4099,"imageSize":3187177,"views":1297,"downloads":734,"collections":2,"likes":7,"comments":2,"user_id":8062673,"user":"Spectaculum","userImageURL":"https://cdn.pixabay.com/user/2018/06/20/08-56-27-417_250x250.jpg"},{"id":4575649,"pageURL":"https://pixabay.com/photos/puppy-dog-biting-german-shepherd-4575649/","type":"photo","tags":"puppy, nature, dog","previewURL":"https://cdn.pixabay.com/photo/2019/10/25/00/10/puppy-4575649_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/ga299f8852f2ca6e854a1f816fd747ea3f03ce3c82f03ae8f464229e461e92d60365b02a4c66b1eb0533f1db52186dac2878daf92635a20f3ad6806f6b5da505a_640.jpg","webformatWidth":640,"webformatHeight":426,"largeImageURL":"https://pixabay.com/get/g45112f7a60567f956b1d5092094d2e5b125dfd4b89a8873b75cd3abc019b930f70c27179a5d91bd18b3aaa173b73b227f7fc9da5cd3f0e21141547bf4e89b717_1280.jpg","imageWidth":6000,"imageHeight":4000,"imageSize":4623033,"views":2275,"downloads":1747,"collections":9,"likes":5,"comments":3,"user_id":11004713,"user":"DaModernDaVinci","userImageURL":"https://cdn.pixabay.com/user/2021/06/15/01-28-17-70_250x250.jpeg"}]}
""";
